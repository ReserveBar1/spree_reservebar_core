<% if line_item.preferred_customization %>

  <%
    engraving_font_style = line_item.variant.product.engraving_font_style.gsub('+', ' ')
    engraving_font_link = "http://fonts.googleapis.com/css?family=" + engraving_font_style
    style_text = "text-align:center; font-family: " + engraving_font_style + "; font-weight: 400; font-size: 12px;display: block;"
  %>
  <link href="<%= engraving_font_link %>" media="screen" rel="stylesheet" />
    
  <div>
    <b>Your Engraving: </b><small>(please hit 'Update' if you change it)</small>
    <% customization_data = JSON.parse(line_item.preferred_customization) %>
    <input type=hidden name="customization[type]" value="jwb_engraving" />
    <div class='engraving-text'>
      <% customization_data.each do |key,value| %>
        <input type=text class='required' name='customization[data][<%= line_item.id -%>][<%= key -%>]' placeholder="<%= key.humanize -%>" value="<%= value -%>" onchange="validateEngraving_<%= line_item.id %>(this);" onkeyup="validateEngraving_<%= line_item.id %>(this);" style="<%= style_text %>" />
      <% end %>
    </div>
  </div>

<% end %>

<%= javascript_tag do %>

  var engravingGuard = false;
  validateEngraving_<%= line_item.id %> = function(element) {
    var value = element.value;
    value = value.substring(0, <%= line_item.product.engraving_char_limit %>);
    value = value.toUpperCase();
    element.value = value;
    if (engravingGuard == false) {
      $('#checkout-link').click(function(e) {
        e.preventDefault();
        alert('Please update cart to save your changes to the engraving before proceeding to checkout.');
      });
      engravingGuard = true;
    }
  }

<% end %>
